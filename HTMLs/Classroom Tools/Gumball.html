<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smiley Gumball Machines</title>

<style>
body {
  font-family: 'Comic Sans MS', cursive;
  background: linear-gradient(#fde68a, #fca5a5);
  text-align: center;
}

h1 {
  font-size: 3em;
  margin-bottom: 20px;
}

/* Sparkle text */
.sparkle {
  font-weight: bold;
  background: linear-gradient(90deg, #fff, #facc15, #fff);
  background-size: 200% auto;
  color: #000;
  background-clip: text;
  -webkit-background-clip: text;
  animation: shimmer 2s linear infinite;
}

@keyframes shimmer {
  to { background-position: 200% center; }
}

.machine-area {
  display: flex;
  justify-content: center;
  gap: 50px;
  flex-wrap: wrap;
}

.machine {
  width: 260px;
}

.jar {
  position: relative;
  width: 240px;
  height: 240px;
  border-radius: 50%;
  border: 8px solid #dc2626;
  background: radial-gradient(circle at top, #ffffff, #fef3c7);
  overflow: hidden;
  margin: 0 auto 10px;
}

.smile-layer {
  position: absolute;
  bottom: 0;
  width: 100%;
}

.smile-row {
  display: flex;
  justify-content: center;
  line-height: 1;
}

.smile {
  font-size: 20px;
  margin: -2px;
}

.base {
  width: 120px;
  height: 90px;
  background: #dc2626;
  margin: 0 auto;
  border-radius: 0 0 20px 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.count {
  color: white;
  font-size: 2em;
  font-weight: bold;
}

input {
  width: 100px;
  margin: 4px;
  text-align: center;
}

button {
  margin-top: 5px;
  cursor: pointer;
}

.fireworks {
  font-size: 3em;
  animation: pop 1s infinite;
}

@keyframes pop {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }
  100% { transform: scale(1); }
}
</style>
</head>
<body>

<h1>ðŸ˜Š Smiley Gumball Machines ðŸ˜Š</h1>

<div style="margin-bottom:20px; font-size:1.3em;">
  Show 
  <select id="machineSelect" onchange="updateMachines()">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3" selected>3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
  </select>
  machines
</div>

<div class="machine-area" id="machineArea"></div>

<script>
const machineArea = document.getElementById("machineArea");

const ROWS = 12;          // how tall the jar fills
const SMILES_PER_ROW = 10; // width density
const MAX_SMILES = ROWS * SMILES_PER_ROW;

/* CREATE MACHINES */
for (let i = 1; i <= 6; i++) {
  const machine = document.createElement("div");
  machine.className = "machine";
  machine.dataset.index = i;

  machine.innerHTML = `
    <input class="machine-name sparkle" placeholder="Machine Name">
    <div>
      Goal: <input type="number" class="goal-input" value="100">
    </div>
    <div class="jar">
      <div class="smile-layer"></div>
    </div>
    <div class="base"><div class="count">0</div></div>
    <input type="number" placeholder="Add Smiles"
      onkeydown="if(event.key==='Enter') addSmiles(this)">
    <br>
    <button onclick="resetMachine(this)">Reset</button>
    <div class="celebrate"></div>
  `;

  machineArea.appendChild(machine);
}

/* ADD SMILES */
function addSmiles(input) {
  const machine = input.closest('.machine');
  const index = machine.dataset.index;
  const goal = parseInt(machine.querySelector('.goal-input').value) || 100;
  let count = parseInt(localStorage.getItem('count'+index)) || 0;

  const add = parseInt(input.value);
  if (!add || count >= goal) return;

  count += add;
  if (count > goal) count = goal;

  localStorage.setItem('count'+index, count);
  input.value = '';

  updateMachine(machine);
}

/* REBUILD JAR WITH STACKED SMILES */
function updateMachine(machine) {
  const index = machine.dataset.index;
  const goal = parseInt(machine.querySelector('.goal-input').value) || 100;
  const count = parseInt(localStorage.getItem('count'+index)) || 0;

  machine.querySelector('.count').textContent = count;

  const smileLayer = machine.querySelector('.smile-layer');
  smileLayer.innerHTML = '';

  const percent = count / goal;
  const totalSmilesToShow = Math.floor(percent * MAX_SMILES);

  let remaining = totalSmilesToShow;

  for (let r = 0; r < ROWS; r++) {
    if (remaining <= 0) break;

    const row = document.createElement('div');
    row.className = 'smile-row';

    const rowCount = Math.min(SMILES_PER_ROW, remaining);

    for (let s = 0; s < rowCount; s++) {
      const smile = document.createElement('span');
      smile.className = 'smile';
      smile.textContent = 'ðŸ˜Š';
      row.appendChild(smile);
    }

    smileLayer.prepend(row);
    remaining -= rowCount;
  }

  if (count >= goal) {
    machine.querySelector('.celebrate').innerHTML =
      '<div class="fireworks">ðŸŽ†ðŸŽ‡âœ¨</div>';
  } else {
    machine.querySelector('.celebrate').innerHTML = '';
  }

  saveMachineSettings(machine);
}

/* RESET */
function resetMachine(btn) {
  const machine = btn.closest('.machine');
  const index = machine.dataset.index;
  localStorage.removeItem('count'+index);
  updateMachine(machine);
}

/* SAVE SETTINGS */
function saveMachineSettings(machine) {
  const index = machine.dataset.index;
  localStorage.setItem('goal'+index,
    machine.querySelector('.goal-input').value);
  localStorage.setItem('name'+index,
    machine.querySelector('.machine-name').value);
}

/* LOAD DATA */
function loadData() {
  for (let i = 1; i <= 6; i++) {
    const machine = document.querySelector(
      `.machine[data-index='${i}']`);

    machine.querySelector('.goal-input').value =
      localStorage.getItem('goal'+i) || 100;

    machine.querySelector('.machine-name').value =
      localStorage.getItem('name'+i) || '';

    updateMachine(machine);
  }

  const savedCount = localStorage.getItem('machineCount') || 3;
  document.getElementById('machineSelect').value = savedCount;
  updateMachines();
}

/* SHOW/HIDE */
function updateMachines() {
  const count = parseInt(document.getElementById('machineSelect').value);
  localStorage.setItem('machineCount', count);

  document.querySelectorAll('.machine')
    .forEach((m, i) =>
      m.style.display = i < count ? 'block' : 'none');
}

document.addEventListener("input", function(e) {
  if (e.target.classList.contains("goal-input") ||
      e.target.classList.contains("machine-name")) {
    const machine = e.target.closest('.machine');
    updateMachine(machine);
  }
});

loadData();
</script>

</body>
</html>
