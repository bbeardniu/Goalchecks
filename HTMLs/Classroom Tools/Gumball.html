<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smiley Gumball Machines</title>

<style>
body {
  font-family: 'Comic Sans MS', 'Chalkboard SE', 'Trebuchet MS', Arial, sans-serif;
  background: linear-gradient(#fde68a, #fca5a5);
  text-align: center;
}

h1 {
  font-size: 3em;
  margin-bottom: 20px;
}

/* Sparkle text */
.sparkle {
  font-weight: bold;
  background: linear-gradient(90deg, #fff, #facc15, #fff);
  background-size: 200% auto;
  color: #000;
  background-clip: text;
  -webkit-background-clip: text;
  animation: shimmer 2s linear infinite;
}

@keyframes shimmer {
  to { background-position: 200% center; }
}

.machine-area {
  display: flex;
  justify-content: center;
  gap: 50px;
  flex-wrap: wrap;
}

.machine {
  width: 260px;
}

.jar {
  position: relative;
  width: 240px;
  height: 240px;
  border-radius: 50%;
  border: 8px solid #dc2626;
  background: radial-gradient(circle at top, #ffffff, #fef3c7);
  overflow: hidden;
  margin: 0 auto 10px;
}

.smile-layer {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 100%;
}

.smile {
  position: absolute;
  font-size: 22px;
  line-height: 1;
  user-select: none;
}

.base {
  width: 120px;
  height: 90px;
  background: #dc2626;
  margin: 0 auto;
  border-radius: 0 0 20px 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.count {
  color: white;
  font-size: 2em;
  font-weight: bold;
}

input {
  width: 100px;
  margin: 4px;
  text-align: center;
}

button {
  margin-top: 5px;
  cursor: pointer;
}

.fireworks {
  font-size: 3em;
  animation: pop 1s infinite;
}

@keyframes pop {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }
  100% { transform: scale(1); }
}
</style>
</head>
<body>

<h1>ðŸ˜Š Smiley Gumball Machines ðŸ˜Š</h1>

<div style="margin-bottom:20px; font-size:1.3em;">
  Show 
  <select id="machineSelect" onchange="updateMachines()">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3" selected>3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
  </select>
  machines
</div>

<div class="machine-area" id="machineArea"></div>

<script>
const machineArea = document.getElementById("machineArea");

const ROWS = 14;
const COLS = 11;
const MAX_SMILES = ROWS * COLS;

const SMILE_SIZE = 22;
const VERTICAL_SPACING = 18;  // smaller than size = overlap
const HORIZONTAL_SPACING = 20; // slight overlap

/* CREATE MACHINES */
for (let i = 1; i <= 6; i++) {
  const machine = document.createElement("div");
  machine.className = "machine";
  machine.dataset.index = i;

  machine.innerHTML = `
    <input class="machine-name sparkle" placeholder="Machine Name">
    <div>
      Goal: <input type="number" class="goal-input" value="100">
    </div>
    <div class="jar">
      <div class="smile-layer"></div>
    </div>
    <div class="base"><div class="count">0</div></div>
    <input type="number" placeholder="Add Smiles"
      onkeydown="if(event.key==='Enter') addSmiles(this)">
    <br>
    <button onclick="resetMachine(this)">Reset</button>
    <div class="celebrate"></div>
  `;

  machineArea.appendChild(machine);
}

/* ADD SMILES */
function addSmiles(input) {
  const machine = input.closest('.machine');
  const index = machine.dataset.index;
  const goal = parseInt(machine.querySelector('.goal-input').value) || 100;
  let count = parseInt(localStorage.getItem('count'+index)) || 0;

  const add = parseInt(input.value);
  if (!add || count >= goal) return;

  count += add;
  if (count > goal) count = goal;

  localStorage.setItem('count'+index, count);
  input.value = '';

  updateMachine(machine);
}

/* PACKED STACK FILL */
function updateMachine(machine) {
  const index = machine.dataset.index;
  const goal = parseInt(machine.querySelector('.goal-input').value) || 100;
  const count = parseInt(localStorage.getItem('count'+index)) || 0;

  machine.querySelector('.count').textContent = count;

  const smileLayer = machine.querySelector('.smile-layer');
  smileLayer.innerHTML = '';

  const percent = count / goal;
  const totalToShow = Math.floor(percent * MAX_SMILES);

  let placed = 0;

  for (let row = 0; row < ROWS; row++) {
    for (let col = 0; col < COLS; col++) {

      if (placed >= totalToShow) break;

      const smile = document.createElement('div');
      smile.className = 'smile';
      smile.textContent = 'ðŸ˜Š';

      // Offset every other row (brick pattern)
      const offset = (row % 2 === 0) ? 0 : HORIZONTAL_SPACING / 2;

      const x = col * HORIZONTAL_SPACING + offset + 10;
      const y = row * VERTICAL_SPACING;

      smile.style.left = x + "px";
      smile.style.bottom = y + "px";

      smileLayer.appendChild(smile);

      placed++;
    }
  }

  if (count >= goal) {
    machine.querySelector('.celebrate').innerHTML =
      '<div class="fireworks">ðŸŽ†ðŸŽ‡âœ¨</div>';
  } else {
    machine.querySelector('.celebrate').innerHTML = '';
  }

  saveMachineSettings(machine);
}

/* RESET */
function resetMachine(btn) {
  const machine = btn.closest('.machine');
  const index = machine.dataset.index;
  localStorage.removeItem('count'+index);
  updateMachine(machine);
}

/* SAVE SETTINGS */
function saveMachineSettings(machine) {
  const index = machine.dataset.index;
  localStorage.setItem('goal'+index,
    machine.querySelector('.goal-input').value);
  localStorage.setItem('name'+index,
    machine.querySelector('.machine-name').value);
}

/* LOAD DATA */
function loadData() {
  for (let i = 1; i <= 6; i++) {
    const machine = document.querySelector(
      `.machine[data-index='${i}']`);

    machine.querySelector('.goal-input').value =
      localStorage.getItem('goal'+i) || 100;

    machine.querySelector('.machine-name').value =
      localStorage.getItem('name'+i) || '';

    updateMachine(machine);
  }

  const savedCount = localStorage.getItem('machineCount') || 3;
  document.getElementById('machineSelect').value = savedCount;
  updateMachines();
}

function updateMachines() {
  const count = parseInt(document.getElementById('machineSelect').value);
  localStorage.setItem('machineCount', count);

  document.querySelectorAll('.machine')
    .forEach((m, i) =>
      m.style.display = i < count ? 'block' : 'none');
}

document.addEventListener("input", function(e) {
  if (e.target.classList.contains("goal-input") ||
      e.target.classList.contains("machine-name")) {
    const machine = e.target.closest('.machine');
    updateMachine(machine);
  }
});

loadData();
</script>

</body>
</html>

